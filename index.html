<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Receiver</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <!-- Uncomment for local p5.js -->
    <!-- <script src="p5.min.js"></script> -->
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000 !important;
            font-family: 'Arial', sans-serif;
            color: #7bd3f7 !important;
            user-select: none;
        }
        #fractal-container {
            position: absolute;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 0;
        }
        #fractal-canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 0;
        }
        #audio-mandala {
            position: relative;
            width: 90vmin !important;
            height: 90vmin !important;
            z-index: 1;
        }
        .parameter-node {
            position: absolute;
            width: 30px !important;
            height: 30px !important;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            z-index: 10;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3) !important;
        }
        .parameter-node:hover {
            transform: translate(-50%, -50%) scale(1.5);
        }
        .parameter-node.active {
            box-shadow: 0 0 15px currentColor !important;
        }
        .node-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #7bd3f7;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 101;
            border: 1px solid #7bd3f7;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
        }
        .parameter-node:hover:not([data-clicked]) .node-tooltip {
            opacity: 1;
        }
        .node-process, .node-file-inputs {
            width: 50px !important;
            height: 50px !important;
            font-size: 12px;
            box-shadow: 0 0 15px currentColor !important;
        }
        .node-player, .node-stop, .node-help, .node-waveform {
            width: 40px !important;
            height: 40px !important;
            font-size: 11px;
            box-shadow: 0 0 12px currentColor !important;
        }
        .node-waveform {
            animation: slow-glow 4s ease-in-out infinite;
        }
        @keyframes slow-glow {
            0% { box-shadow: 0 0 12px rgba(211, 123, 247, 0.3); }
            50% { box-shadow: 0 0 20px rgba(211, 123, 247, 0.8); }
            100% { box-shadow: 0 0 12px rgba(211, 123, 247, 0.3); }
        }
        .node-connection {
            position: absolute;
            height: 1px;
            background: linear-gradient(90deg, rgba(123, 211, 247, 0), #7bd3f7, rgba(123, 211, 247, 0));
            transform-origin: 0 0;
            z-index: 1;
            opacity: 0.3;
        }
        #control-panel {
            position: fixed;
            top: 20%;
            right: 20px;
            background: rgba(0, 0, 0, 0.9) !important;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #7bd3f7;
            z-index: 100;
            min-width: 250px;
            box-shadow: 0 0 20px rgba(123, 211, 247, 0.5);
            display: none;
        }
        .control-group {
            margin-bottom: 10px;
            position: relative;
        }
        .control-group label {
            color: #7bd3f7;
            font-size: 12px;
            margin-bottom: 5px;
            display: block;
        }
        .control-group input, .control-group select {
            background: rgba(123, 211, 247, 0.1);
            color: #7bd3f7;
            border: 1px solid #7bd3f7;
            border-radius: 3px;
            padding: 5px;
            width: 100%;
            font-size: 12px;
        }
        .control-group input[type="range"]::-webkit-slider-thumb {
            background: #7bd3f7;
            border-radius: 50%;
            width: 15px;
            height: 15px;
            cursor: pointer;
        }
        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: #7bd3f7;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 101;
            border: 1px solid #7bd3f7;
        }
        .control-group:hover .tooltip {
            opacity: 1;
        }
        #status-display {
            position: absolute;
            bottom: 60%;
            left: 91%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9) !important;
            padding: 10px 20px;
            border-radius: 5px;
            border: 1px solid #7bd3f7;
            max-width: 80%;
            text-align: center;
            z-index: 100;
            pointer-events: none;
            font-size: 14px;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #status-display[style*="display: block"] {
            opacity: 1;
        }
        #file-inputs {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9) !important;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #7bd3f7;
            z-index: 100;
            width: 300px;
            max-width: 90%;
            box-shadow: 0 0 30px rgba(123, 211, 247, 0.5);
            display: none;
            max-height: 70vh;
            overflow-y: auto;
        }
        .upload-area {
            border: 2px dashed #7bd3f7;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
            color: #7bd3f7;
            font-size: 14px;
        }
        .upload-area:hover {
            background: rgba(123, 211, 247, 0.1);
        }
        .file-upload-input {
            margin-bottom: 10px;
            font-size: 12px;
        }
        .file-upload-input label {
            color: #7bd3f7;
            margin-right: 10px;
        }
        .file-upload-input input[type="file"] {
            color: #7bd3f7;
        }
        .file-name, .file-error, .file-bpm {
            color: #7bd3f7;
            font-size: 10px;
            display: block;
        }
        .file-waveform {
            width: 100%;
            height: 40px;
            margin-top: 5px;
        }
        button {
            background: rgba(123, 211, 247, 0.3);
            color: #7bd3f7;
            border: 1px solid #7bd3f7;
            border-radius: 3px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        button:hover:not(:disabled) {
            background: rgba(123, 211, 247, 0.6);
            box-shadow: 0 0 10px rgba(123, 211, 247, 0.7);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        #audio-player-container {
            position: fixed;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px !important;
            z-index: 50;
            opacity: 0.8;
            transition: opacity 0.3s;
            background: rgba(0, 0, 0, 0.7) !important;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #7bd3f7;
            box-shadow: 0 0 20px rgba(123, 211, 247, 0.5);
            display: none;
        }
        #audio-player-container:hover {
            opacity: 1;
        }
        #mixed-audio {
            width: 100%;
            margin-top: 5px;
        }
        #close-player {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 30px;
            height: 30px;
            background: rgba(247, 123, 211, 0.3);
            border: 1px solid #f77bd3;
            border-radius: 50%;
            color: #f77bd3;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        #close-player:hover {
            background: rgba(247, 123, 211, 0.6);
            transform: scale(1.2);
        }
        #stop-audio-btn {
            position: absolute;
            top: -15px;
            left: -15px;
            width: 30px;
            height: 30px;
            background: rgba(123, 211, 247, 0.3);
            border: 1px solid #7bd3f7;
            border-radius: 50%;
            color: #7bd3f7;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        #stop-audio-btn:hover {
            background: rgba(123, 211, 247, 0.6);
            transform: scale(1.2);
        }
        #waveform-container {
            position: fixed;
            top: calc(50% - 1px);
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px !important;
            height: 60px !important;
            z-index: 50;
            opacity: 0.8;
            transition: opacity 0.3s;
            background: rgba(0, 0, 0, 0.7) !important;
            border-radius: 0px;
            border: 1px solid #7bd3f7;
            box-shadow: 0 0 20px rgba(123, 211, 247, 0.5);
            display: none;
        }
        #waveform-container:hover {
            opacity: 1;
        }
        #waveform-canvas {
            position: fixed;
            top: calc(50% - 1px);
            left: 50%;
            width: 100%;
            height: 100%;
        }
        #logo {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px !important;
            color: #7bd3f7 !important;
            opacity: 0.7;
            z-index: 20;
            text-align: center;
            font-family: 'monospace', monospace;
            pointer-events: none;
            animation: glow 2s ease-in-out infinite;
        }
        #help-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9) !important;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #7bd3f7;
            z-index: 100;
            width: 500px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 30px rgba(123, 211, 247, 0.5);
            display: none;
            color: #7bd3f7;
            font-family: 'Arial', sans-serif;
        }
        #help-panel h1, #help-panel h2, #help-panel h3 {
            color: #7bd3f7;
            text-shadow: 0 0 5px rgba(123, 211, 247, 0.5);
        }
        #help-panel p, #help-panel ul, #help-panel li {
            font-size: 14px;
            line-height: 1.5;
        }
        #help-panel ul {
            padding-left: 20px;
        }
        #close-help {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 30px;
            height: 30px;
            background: rgba(247, 123, 211, 0.3);
            border: 1px solid #f77bd3;
            border-radius: 50%;
            color: #f77bd3;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        #close-help:hover {
            background: rgba(247, 123, 211, 0.6);
            transform: scale(1.2);
        }
        @keyframes glow {
            0% { text-shadow: 0 0 5px rgba(123, 211, 247, 0.5); }
            50% { text-shadow: 0 0 10px rgba(123, 211, 247, 0.8); }
            100% { text-shadow: 0 0 5px rgba(123, 211, 247, 0.5); }
        }
        @keyframes pulse {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }
        .pulse {
            animation: pulse 3s infinite;
        }
        @keyframes ripple {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background: rgba(123, 211, 247, 0.6);
            transform: translate(-50%, -50%);
            pointer-events: none;
            animation: ripple 1s linear;
            z-index: 5;
        }
    </style>
</head>
<body>
    <div id="fractal-container">
        <canvas id="fractal-canvas"></canvas>
        <div id="audio-mandala">
            <div class="parameter-node" id="node-track-count" style="background: rgba(123, 211, 247, 0.3); border-color: #7bd3f7; color: #7bd3f7;" data-tooltip="Number of Tracks"><span class="node-tooltip"></span></div>
            <div class="parameter-node" id="node-project-bpm" style="background: rgba(247, 123, 211, 0.3); border-color: #f77bd3; color: #f77bd3;" data-tooltip="Project BPM"><span class="node-tooltip"></span></div>
            <div class="parameter-node" id="node-max-blend" style="background: rgba(176, 123, 247, 0.3); border-color: #b07bf7; color: #b07bf7;" data-tooltip="Max Blend"><span class="node-tooltip"></span></div>
            <div class="parameter-node" id="node-wet-dry" style="background: rgba(123, 247, 163, 0.3); border-color: #7bf7a3; color: #7bf7a3;" data-tooltip="Wet/Dry Mix"><span class="node-tooltip"></span></div>
            <div class="parameter-node" id="node-reverb-time" style="background: rgba(247, 211, 123, 0.3); border-color: #f7d37b; color: #f7d37b;" data-tooltip="Reverb Time"><span class="node-tooltip"></span></div>
            <div class="parameter-node" id="node-loop-duration" style="background: rgba(123, 163, 247, 0.3); border-color: #7ba3f7; color: #7ba3f7;" data-tooltip="Loop Duration"><span class="node-tooltip"></span></div>
            <div class="parameter-node" id="node-algorithm" style="background: rgba(211, 123, 247, 0.3); border-color: #d37bf7; color: #d37bf7;" data-tooltip="Algorithm"><span class="node-tooltip"></span></div>
            <div class="parameter-node" id="node-musical-scale" style="background: rgba(247, 123, 123, 0.3); border-color: #f77b7b; color: #f77b7b;" data-tooltip="Musical Scale"><span class="node-tooltip"></span></div>
            <div class="parameter-node" id="node-scale-behavior" style="background: rgba(123, 247, 211, 0.3); border-color: #7bf7d3; color: #7bf7d3;" data-tooltip="Scale Behavior"><span class="node-tooltip"></span></div>
            <div class="parameter-node" id="node-playback-rate" style="background: rgba(163, 123, 247, 0.3); border-color: #a37bf7; color: #a37bf7;" data-tooltip="Playback Rate"><span class="node-tooltip"></span></div>
            <div class="parameter-node" id="node-preserve-pitch" style="background: rgba(247, 163, 123, 0.3); border-color: #f7a37b; color: #f7a37b;" data-tooltip="Preserve Pitch"><span class="node-tooltip"></span></div>
            <div class="parameter-node" id="node-silence" style="background: rgba(123, 211, 163, 0.3); border-color: #7bd3a3; color: #7bd3a3;" data-tooltip="Silence Percentage"><span class="node-tooltip"></span></div>
            <div class="parameter-node node-file-inputs" id="node-file-inputs" style="background: rgba(211, 247, 123, 0.3); border-color: #d3f77b; color: #d3f77b;" data-tooltip="Upload Files"><span class="node-tooltip"></span></div>
            <div class="parameter-node node-process" id="node-process" style="background: rgba(247, 123, 163, 0.3); border-color: #f77ba3; color: #f77ba3;" data-tooltip="Process Audio"><span class="node-tooltip"></span></div>
            <div class="parameter-node node-player" id="node-player" style="background: rgba(123, 247, 247, 0.3); border-color: #7bf7f7; color: #7bf7f7;" data-tooltip="Show/Hide Player"><span class="node-tooltip"></span></div>
            <div class="parameter-node node-stop" id="node-stop-audio" style="background: rgba(247, 123, 247, 0.3); border-color: #f77bf7; color: #f77bf7;" data-tooltip="Stop Audio"><span class="node-tooltip"></span></div>
            <div class="parameter-node node-help" id="node-help" style="background: rgba(123, 247, 211, 0.3); border-color: #7bf7d3; color: #7bf7d3;" data-tooltip="Help"><span class="node-tooltip"></span></div>
            <div class="parameter-node node-waveform" id="node-waveform" style="background: rgba(211, 123, 247, 0.3); border-color: #d37bf7; color: #d37bf7;" data-tooltip="Show/Hide Waveform"><span class="node-tooltip"></span></div>
            <div class="node-connection" id="conn-1"></div>
            <div class="node-connection" id="conn-2"></div>
            <div class="node-connection" id="conn-3"></div>
            <div class="node-connection" id="conn-4"></div>
            <div class="node-connection" id="conn-5"></div>
            <div class="node-connection" id="conn-6"></div>
            <div class="node-connection" id="conn-7"></div>
            <div class="node-connection" id="conn-8"></div>
            <div class="node-connection" id="conn-9"></div>
            <div id="logo">o r a c L e</div>
        </div>
        <div id="control-panel">
            <h2>Parameter Control</h2>
            <div class="control-group" id="control-track-count" style="display: none;">
                <label for="track-count">Number of Tracks:</label>
                <select id="track-count" name="track-count">
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5" selected>5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
                <span class="tooltip">Adjust number of audio tracks (2-10)</span>
            </div>
            <div class="control-group" id="control-project-bpm" style="display: none;">
                <label for="project-bpm">Project BPM:</label>
                <input type="number" id="project-bpm" value="120" min="60" max="240">
                <span class="tooltip">Set project tempo (60-240 BPM)</span>
            </div>
            <div class="control-group" id="control-max-blend" style="display: none;">
                <label for="max-blend">Max Blend (%):</label>
                <input type="range" id="max-blend" min="0" max="100" value="50">
                <span id="blend-value">50%</span>
                <span class="tooltip">Control maximum blend between tracks</span>
            </div>
            <div class="control-group" id="control-wet-dry" style="display: none;">
                <label for="wet-dry">Wet/Dry Mix:</label>
                <input type="range" id="wet-dry" min="0" max="1" step="0.01" value="0.5">
                <span id="wet-dry-value">50%</span>
                <span class="tooltip">Balance between reverb and dry signal</span>
            </div>
            <div class="control-group" id="control-reverb-time" style="display: none;">
                <label for="reverb-time">Reverb Time (s):</label>
                <input type="range" id="reverb-time" min="0.1" max="5" step="0.1" value="2.0">
                <span id="reverb-time-value">2.0s</span>
                <span class="tooltip">Set reverb decay time</span>
            </div>
            <div class="control-group" id="control-loop-duration" style="display: none;">
                <label for="loop-duration">Loop Duration (min):</label>
                <input type="range" id="loop-duration" min="0.1" max="10" step="0.1" value="5">
                <span id="loop-duration-value">5.0</span>
                <span class="tooltip">Set duration for looping mix</span>
            </div>
            <div class="control-group" id="control-algorithm" style="display: none;">
                <label for="algorithm-select">Algorithm:</label>
                <select id="algorithm-select">
                    <option value="sequential">Sequential</option>
                    <option value="random">Random</option>
                    <option value="markov">Markov Chain</option>
                    <option value="scale-order-asc">Scale Ascending</option>
                    <option value="scale-order-desc">Scale Descending</option>
                    <option value="freq-asc">Center Freq Ascending</option>
                    <option value="freq-desc">Center Freq Descending</option>
                    <option value="tempo-asc">Tempo Ascending</option>
                    <option value="tempo-desc">Tempo Descending</option>
                </select>
                <span class="tooltip">Choose track ordering algorithm</span>
            </div>
            <div class="control-group" id="control-musical-scale" style="display: none;">
                <label for="musical-scale">Musical Scale:</label>
                <select id="musical-scale">
                    <option value="none">None</option>
                    <option value="major">Major</option>
                    <option value="minor">Minor</option>
                    <option value="harmonicMinor">Harmonic Minor</option>
                    <option value="melodicMinor">Melodic Minor</option>
                    <option value="pentatonic">Pentatonic</option>
                    <option value="blues">Blues</option>
                    <option value="chromatic">Chromatic</option>
                </select>
                <span class="tooltip">Select musical scale for filtering</span>
            </div>
            <div class="control-group" id="control-scale-behavior" style="display: none;">
                <label for="scale-behavior">Scale Behavior:</label>
                <select id="scale-behavior">
                    <option value="filter">Filter</option>
                    <option value="transpose">Transpose</option>
                    <option value="reorder">Reorder</option>
                </select>
                <span class="tooltip">Define scale adjustment behavior</span>
            </div>
            <div class="control-group" id="control-playback-rate" style="display: none;">
                <label for="playback-rate">Playback Rate:</label>
                <input type="range" id="playback-rate" min="0.5" max="2" step="0.01" value="1.0">
                <span id="playback-rate-value">1.00x</span>
                <span class="tooltip">Adjust playback speed</span>
            </div>
            <div class="control-group" id="control-preserve-pitch" style="display: none;">
                <label for="preserve-pitch">Preserve Pitch:</label>
                <input type="checkbox" id="preserve-pitch" checked>
                <span class="tooltip">Maintain pitch when changing rate</span>
            </div>
            <div class="control-group" id="control-silence" style="display: none;">
                <label for="silence-percentage">Silence (%):</label>
                <input type="range" id="silence-percentage" min="0" max="100" value="10">
                <span id="silence-value">10%</span>
                <span class="tooltip">Add silence between tracks</span>
            </div>
            <div class="control-group" id="control-process" style="display: none;">
                <button id="process-btn">Process Audio</button>
                <button id="test-tone-btn">Test Tone</button>
                <button id="download-btn" disabled>Download Mix</button>
                <button id="stop-btn" disabled>Stop Playback</button>
                <span class="tooltip">Audio processing controls</span>
            </div>
        </div>
        <div id="file-inputs">
            <div class="upload-area">Drag and drop audio files or click to select</div>
        </div>
        <div id="status-display"></div>
        <div id="audio-player-container">
            <button id="close-player">×</button>
            <button id="stop-audio-btn">■</button>
            <audio id="mixed-audio" controls></audio>
        </div>
        <div id="waveform-container">
            <canvas id="waveform-canvas"></canvas>
        </div>
        <div id="help-panel">
            <button id="close-help">×</button>
            <div id="help-content"></div>
        </div>
        <canvas id="waveform" style="display: none;"></canvas>
        <div id="loop-status" style="display: none;"></div>
    </div>
    <script src="app.js"></script>
    <script>
        // Load manual content into help panel
        const helpContent = document.getElementById('help-content');
        const helpPanel = document.getElementById('help-panel');
        const closeHelp = document.getElementById('close-help');

        // Manual content (Markdown rendered as HTML)
        const manualContent = `
<h1>World Receiver User Manual</h1>
<p><em>Welcome to the World Receiver, a sonic mandala for crafting immersive audio experiences. Harness the power of sound manipulation in a futuristic interface glowing with cybernetic elegance.</em></p>
<h2>Overview</h2>
<p>The <strong>World Receiver</strong> is an interactive audio processing tool that blends multiple audio tracks into a cohesive mix, visualized through a dynamic mandala interface. Adjust parameters like tempo, reverb, and playback rate, and watch the mandala pulse with your creations. Upload audio files, tweak settings, and download your masterpiece—all within a sleek, neon-lit environment.</p>
<h2>Interface Elements</h2>
<p>The app is centered around a glowing mandala with interactive nodes, each controlling a specific function. The background fractal canvas and logo pulse in sync with your audio, creating a mesmerizing experience.</p>
<h3>Key Components</h3>
<ul>
    <li><strong>Mandala Nodes</strong>: Circular controls around the central mandala, each tied to a parameter or action (e.g., track count, BPM, file uploads). Hover over a node to see its tooltip explanation (shown only until the node is first clicked).</li>
    <li><strong>Control Panel</strong>: A sidebar for fine-tuning parameters, appearing when a node is clicked.</li>
    <li><strong>File Upload Panel</strong>: A central popup for uploading audio files.</li>
    <li><strong>Audio Player</strong>: A compact player for previewing and controlling the mixed audio.</li>
    <li><strong>Waveform Display</strong>: Visualizes the mixed audio's waveform in real-time, hidden after one audio loop.</li>
    <li><strong>Status Display</strong>: Shows temporary messages (e.g., "Track loaded") at the bottom-right.</li>
    <li><strong>Help Node</strong>: A glowing node in the mandala to open this manual.</li>
    <li><strong>Waveform Node</strong>: A slowly pulsing node to toggle the waveform display.</li>
    <li><strong>o r a c L e Logo</strong>: A pulsating centerpiece tying the interface together.</li>
</ul>
<h2>Features and How to Use</h2>
<h3>1. Uploading Audio Files</h3>
<ul>
    <li><strong>Access</strong>: Click the <strong>Upload Files</strong> node (yellow-green, labeled "Upload Files"). Hover to see its tooltip before clicking.</li>
    <li><strong>Action</strong>: The file upload panel appears in the center. Drag and drop audio files (e.g., MP3, WAV) into the upload area or click to select files manually.</li>
    <li><strong>Details</strong>: The number of file slots depends on the <strong>Number of Tracks</strong> setting (2–10). Each slot shows the file name and a waveform preview after upload.</li>
    <li><strong>Status</strong>: The status display confirms each file loaded (e.g., "Track 1 loaded: song.mp3"). When all tracks are loaded, the panel closes automatically, and the status shows "All tracks loaded. Ready to process."</li>
</ul>
<h3>2. Setting Parameters</h3>
<p>Click a parameter node to open the control panel on the right. Adjust settings and see real-time feedback in the status display. Hover over a node to see its tooltip (until clicked). Available parameters:</p>
<ul>
    <li><strong>Number of Tracks (2–10)</strong>: Sets how many audio files to upload. Default: 5.</li>
    <li><strong>Project BPM (60–240)</strong>: Sets the project tempo for alignment (affects visualization, not playback).</li>
    <li><strong>Max Blend (0–100%)</strong>: Controls track overlap intensity.</li>
    <li><strong>Wet/Dry Mix (0–100%)</strong>: Balances reverb and original audio.</li>
    <li><strong>Reverb Time (0.1–5s)</strong>: Sets reverb decay length.</li>
    <li><strong>Loop Duration (0.1–10 min)</strong>: Defines the output mix duration.</li>
    <li><strong>Algorithm</strong>: Chooses track ordering (e.g., Sequential, Random, Markov Chain, Scale-based, Frequency-based, Tempo-based).</li>
    <li><strong>Musical Scale</strong>: Filters tracks by scale (e.g., Major, Minor, Pentatonic).</li>
    <li><strong>Scale Behavior</strong>: Defines scale application (Filter, Transpose, Reorder).</li>
    <li><strong>Playback Rate (0.5–2x)</strong>: Adjusts playback speed.</li>
    <li><strong>Preserve Pitch</strong>: Maintains pitch when changing playback rate (checked by default).</li>
    <li><strong>Silence Percentage (0–100%)</strong>: Adds silence between tracks.</li>
</ul>
<p><strong>Usage</strong>: Click a node (e.g., "Project BPM"), adjust the slider/input in the control panel, and see the status update (e.g., "Project BPM updated to 140"). The mandala pulses with each interaction. Tooltips disappear after clicking a node.</p>
<h3>3. Processing Audio</h3>
<ul>
    <li><strong>Access</strong>: Click the <strong>Process Audio</strong> node (pink, labeled "Process Audio").</li>
    <li><strong>Action</strong>: Combines uploaded tracks based on parameters (e.g., reverb, playback rate, algorithm). The process uses the Web Audio API to mix tracks offline.</li>
    <li><strong>Status</strong>: Shows "Processing audio..." during processing and "Audio processed successfully" when complete. The audio player and waveform display appear automatically.</li>
    <li><strong>Note</strong>: Ensure all required tracks are uploaded, or the status display will show an error.</li>
</ul>
<h3>4. Playing and Controlling Audio</h3>
<ul>
    <li><strong>Access</strong>: Click the <strong>Show/Hide Player</strong> node (cyan, labeled "Show/Hide Player") to toggle the audio player.</li>
    <li><strong>Controls</strong>:
        <ul>
            <li><strong>Play/Pause</strong>: Use the audio player's built-in controls.</li>
            <li><strong>Stop</strong>: Click the <strong>Stop Audio</strong> node (magenta, labeled "Stop Audio") or the stop button (■) on the player to stop and reset playback.</li>
            <li><strong>Close Player</strong>: Click the close button (×) on the player to hide it.</li>
     <li><strong>IMPORTANT</strong>: Wait until 'Audio Rendering Complete' to hear the final output. Large files takes time to process. </li>
 <li><strong>IMPORTANT</strong>: Start with small loop times, e.g 1 minute (default 5 minutes) and also start with small file size (less than 10Mb.</li>
 <li><strong>More:</strong>: When you get the app's logic, move to larger times and sizes (expect long rendering times)</li>
        </ul>
    </li>
    <li><strong>Visualization</strong>: The waveform display (toggled separately) scrolls in real-time, and the logo and nodes glow in sync with the audio's intensity.</li>
</ul>
<h3>5. Toggling Waveform Display</h3>
<ul>
    <li><strong>Access</strong>: Click the <strong>Show/Hide Waveform</strong> node (purple, labeled "Show/Hide Waveform") to toggle the waveform display.</li>
    <li><strong>Action</strong>: Shows or hides the real-time scrolling waveform of the mixed audio. The waveform automatically hides after the audio completes one full loop.</li>
    <li><strong>Visualization</strong>: The waveform node pulses slowly with a glowing effect, enhancing the cyberpunk aesthetic.</li>
</ul>
<h3>6. Downloading the Mix</h3>
<ul>
    <li><strong>Access</strong>: In the control panel (after clicking "Process Audio"), click the <strong>Download Mix</strong> button.</li>
    <li><strong>Action</strong>: Downloads the processed mix as a WAV file named "mixed-audio.wav".</li>
    <li><strong>Status</strong>: Shows "Downloading mix..." during the process.</li>
</ul>
<h3>7. Testing Audio Output</h3>
<ul>
    <li><strong>Access</strong>: In the control panel, click the <strong>Test Tone</strong> button.</li>
    <li><strong>Action</strong>: Plays a 440Hz sine wave for 1 second to test audio output.</li>
    <li><strong>Status</strong>: Shows "Playing test tone."</li>
</ul>
<h3>8. Visual Feedback</h3>
<ul>
    <li><strong>Mandala</strong>: Nodes glow and pulse when clicked or during audio playback, with colors matching their function (e.g., cyan for player, purple for waveform).</li>
    <li><strong>Fractal Canvas</strong>: A dynamic background that scales and rotates, reacting to time and audio.</li>
    <li><strong>Logo</strong>: The "o r a c L e" text glows with a cybernetic pulse, intensifying with audio output.</li>
    <li><strong>Waveforms</strong>: Each uploaded track shows a waveform in the file upload panel, and the mixed audio has a scrolling waveform in the waveform display.</li>
</ul>
<h3>9. Accessing Help</h3>
<ul>
    <li><strong>Access</strong>: Click the <strong>Help</strong> node (teal, labeled "Help") in the mandala.</li>
    <li><strong>Action</strong>: Opens a popup panel displaying this manual. Click the close button (×) to dismiss it.</li>
    <li><strong>Status</strong>: No status message is shown for opening/closing the help panel.</li>
</ul>
<h2>Tips for Use</h2>
<ul>
    <li><strong>File Formats</strong>: Use common audio formats (MP3, WAV). Ensure files are not corrupted.</li>
    <li><strong>Track Count</strong>: Set the number of tracks before uploading to avoid resetting uploads.</li>
    <li><strong>Processing Time</strong>: Large files or long loop durations may take longer to process.</li>
    <li><strong>Browser Compatibility</strong>: Use a modern browser (Chrome, Firefox) with Web Audio API support.</li>
    <li><strong>Responsive Design</strong>: The interface adapts to window size, but nodes may reposition on resize.</li>
</ul>
<h2>Troubleshooting</h2>
<ul>
    <li><strong>No Status Messages</strong>: Ensure JavaScript is enabled. Check the console (F12) for errors.</li>
    <li><strong>Audio Not Playing</strong>: Verify files are valid and audio output is not muted.</li>
    <li><strong>Processing Fails</strong>: Check if all tracks are uploaded and parameters are valid.</li>
    <li><strong>Nodes Not Responding</strong>: Refresh the page and ensure the browser window is focused.</li>
</ul>
<p><em>Craft your sonic universe with the World Receiver. Let the mandala guide your creativity.</em></p>
        `;

        helpContent.innerHTML = manualContent;

        closeHelp.addEventListener('click', () => {
            helpPanel.style.display = 'none';
            if (window.p5) loop();
        });

        // Error handling wrapper
        try {
            console.log('Script execution started');

            // p5.js sketch for mandala background
            function setup() {
                console.log('p5 setup started');
                let canvas = createCanvas(windowWidth, windowHeight);
                if (!canvas) throw new Error('Canvas creation failed');
                canvas.parent('fractal-canvas');
                colorMode(HSB, 360, 100, 100, 1);
                noFill();
                angleMode(DEGREES);
                loop();
                console.log('p5 setup complete');
            }

            let time = 0;
            function draw() {
                background(0, 0, 0, 0.1);
                translate(width / 2, height / 2);
                let scale = map(sin(time * 0.05), -1, 1, 0.8, 1.2);
                drawMandala(0, 0, 200 * scale, 8, 4);
                time += 0.1;
            }

            function drawMandala(x, y, radius, sides, depth) {
                if (depth <= 0 || radius < 10) return;
                let hue = (time * 5 + depth * 60) % 360;
                stroke(hue, 80, 100, 0.5);
                strokeWeight(depth * 0.5);
                beginShape();
                for (let i = 0; i < 360; i += 360 / sides) {
                    let angle = i + sin(time + depth * 10) * 10;
                    let r = radius * (0.8 + sin(time + i) * 0.2);
                    let px = x + cos(angle) * r;
                    let py = y + sin(angle) * r;
                    vertex(px, py);
                }
                endShape(CLOSE);
                let newRadius = radius * 0.6;
                drawMandala(x, y, newRadius, sides, depth - 1);
            }

            function windowResized() {
                resizeCanvas(windowWidth, windowHeight);
            }

            // Position nodes dynamically
            const nodes = document.querySelectorAll('.parameter-node');
            console.log('Nodes found:', nodes.length);
            const mandala = document.getElementById('audio-mandala');
            if (!mandala) console.error('Mandala element not found');
            function positionNodes() {
                if (!mandala) {
                    console.error('Mandala element not found during positioning');
                    return;
                }
                const radiusOuter = 45;
                const radiusInner = 25;
                const count = nodes.length;
                const outerCount = Math.ceil(count / 2);
                nodes.forEach((node, i) => {
                    const isOuter = i < outerCount;
                    const r = isOuter ? radiusOuter : radiusInner;
                    const angle = (i % outerCount) * (360 / outerCount);
                    const x = 50 + r * Math.cos(angle * Math.PI / 180);
                    const y = 50 + r * Math.sin(angle * Math.PI / 180);
                    node.style.left = `${x}%`;
                    node.style.top = `${y}%`;
                    const tooltip = node.querySelector('.node-tooltip');
                    if (tooltip) tooltip.textContent = node.dataset.tooltip || '';
                });
                console.log('Nodes positioned');
            }
            positionNodes();
            window.addEventListener('resize', positionNodes);

            // Node interactions
            const controlPanel = document.getElementById('control-panel');
            const fileInputs = document.getElementById('file-inputs');
            const audioPlayer = document.getElementById('audio-player-container');
            const waveformContainer = document.getElementById('waveform-container');
            const closePlayer = document.getElementById('close-player');
            const stopAudioBtn = document.getElementById('stop-audio-btn');
            const helpPanel = document.getElementById('help-panel');
            const connections = document.querySelectorAll('.node-connection');

            if (nodes && controlPanel && fileInputs && audioPlayer && closePlayer && waveformContainer && stopAudioBtn && helpPanel) {
                console.log('Node interactions initialized');
                nodes.forEach(node => {
                    node.addEventListener('click', (e) => {
                        console.log('Node clicked:', node.id);
                        // Mark node as clicked to disable tooltip
                        node.setAttribute('data-clicked', 'true');
                        document.querySelectorAll('.node-tooltip').forEach(tooltip => {
                            tooltip.style.opacity = '0';
                        });

                        nodes.forEach(n => n.classList.remove('active'));
                        node.classList.add('active');
                        document.querySelectorAll('.control-group').forEach(c => c.style.display = 'none');
                        const controlId = `control-${node.id.replace('node-', '')}`;
                        const control = document.getElementById(controlId);
                        if (control) {
                            control.style.display = 'block';
                            controlPanel.style.display = 'block';
                            fileInputs.style.display = 'none';
                            helpPanel.style.display = 'none';
                        }
                        if (node.id === 'node-file-inputs') {
                            fileInputs.style.display = 'block';
                            controlPanel.style.display = 'none';
                            helpPanel.style.display = 'none';
                        }
                        if (node.id === 'node-player') {
                            const isVisible = audioPlayer.style.display === 'none';
                            audioPlayer.style.display = isVisible ? 'block' : 'none';
                            controlPanel.style.display = 'none';
                            fileInputs.style.display = 'none';
                            helpPanel.style.display = 'none';
                        }
                        if (node.id === 'node-waveform') {
                            const isVisible = waveformContainer.style.display === 'none';
                            waveformContainer.style.display = isVisible ? 'block' : 'none';
                            controlPanel.style.display = 'none';
                            fileInputs.style.display = 'none';
                            helpPanel.style.display = 'none';
                        }
                        if (node.id === 'node-stop-audio') {
                            console.log('Stop Audio node clicked');
                            const audio = document.getElementById('mixed-audio');
                            if (audio) {
                                console.log('Attempting to stop audio');
                                audio.pause();
                                audio.currentTime = 0;
                                if (window.stopPlayback) {
                                    window.stopPlayback();
                                    console.log('stopPlayback called');
                                }
                            } else {
                                console.error('Mixed audio element not found');
                            }
                            controlPanel.style.display = 'none';
                            fileInputs.style.display = 'none';
                            helpPanel.style.display = 'none';
                        }
                        if (node.id === 'node-help') {
                            helpPanel.style.display = 'block';
                            controlPanel.style.display = 'none';
                            fileInputs.style.display = 'none';
                            audioPlayer.style.display = 'none';
                            waveformContainer.style.display = 'none';
                        }

                        const ripple = document.createElement('div');
                        ripple.className = 'ripple-effect';
                        ripple.style.left = `${e.clientX}px`;
                        ripple.style.top = `${e.clientY}px`;
                        ripple.style.width = '30px';
                        ripple.style.height = '30px';
                        document.body.appendChild(ripple);
                        setTimeout(() => ripple.remove(), 1000);

                        if (window.p5) time += p5.prototype.random(1, 3);
                    });
                });

                closePlayer.addEventListener('click', () => {
                    audioPlayer.style.display = 'none';
                    document.querySelectorAll('.node-tooltip').forEach(tooltip => {
                        tooltip.style.opacity = '0';
                    });
                    if (window.p5) loop();
                });

                stopAudioBtn.addEventListener('click', () => {
                    console.log('Stop button clicked');
                    const audio = document.getElementById('mixed-audio');
                    if (audio) {
                        console.log('Attempting to stop audio via button');
                        audio.pause();
                        audio.currentTime = 0;
                        if (window.stopPlayback) {
                            window.stopPlayback();
                            console.log('stopPlayback called from button');
                        }
                    } else {
                        console.error('Mixed audio element not found in button click');
                    }
                    document.querySelectorAll('.node-tooltip').forEach(tooltip => {
                        tooltip.style.opacity = '0';
                    });
                    if (window.p5) loop();
                });

                let trackCount = parseInt(document.getElementById('track-count')?.value) || 5;
                const trackCountInput = document.getElementById('track-count');
                if (trackCountInput) {
                    trackCountInput.addEventListener('change', () => {
                        trackCount = parseInt(trackCountInput.value) || 5;
                        window.showStatus(`Track count set to ${trackCount}. Upload files.`, 'click');
                    });
                }

                const loopDurationInput = document.getElementById('loop-duration');
                const loopDurationValue = document.getElementById('loop-duration-value');
                if (loopDurationInput && loopDurationValue) {
                    loopDurationInput.addEventListener('input', () => {
                        const value = parseFloat(loopDurationInput.value).toFixed(1);
                        loopDurationValue.textContent = `${value}`;
                        window.showStatus(`Loop duration set to ${value} min.`, 'info');
                    });
                    loopDurationValue.textContent = `${parseFloat(loopDurationInput.value).toFixed(1)}`;
                }

                const fileInputsObserver = new MutationObserver(() => {
                    try {
                        console.log('MutationObserver triggered');
                        const fileUploadInputs = fileInputs.querySelectorAll('input[type="file"]');
                        console.log(`Found ${fileUploadInputs.length} file inputs`);
                        if (!fileUploadInputs.length) {
                            console.warn('No file inputs found in #file-inputs');
                            window.showStatus('No file inputs detected. Please upload files.', 'warning');
                            return;
                        }
                        const selectedFiles = Array.from(fileUploadInputs).filter(inp => inp.files.length > 0);
                        console.log(`Selected files: ${selectedFiles.length}/${trackCount}`);
                        if (selectedFiles.length > 0) {
                            window.showStatus(`${selectedFiles.length}/${trackCount} tracks loaded.`, 'info');
                        }
                        if (selectedFiles.length >= trackCount) {
                            fileInputs.style.display = 'none';
                            document.querySelectorAll('.node-tooltip').forEach(tooltip => tooltip.style.opacity = '0');
                            window.showStatus('All tracks loaded. Ready to process.', 'success');
                            if (window.p5) loop();
                            positionNodes();
                            updateConnections();
                            const canvas = document.getElementById('fractal-canvas');
                            if (canvas) canvas.style.display = 'block';
                            const event = new Event('allTracksLoaded');
                            fileInputs.dispatchEvent(event);
                        }
                    } catch (e) {
                        console.error('File input observer error:', e);
                        window.showStatus('Error monitoring file inputs. Check console.', 'error');
                    }
                });
                fileInputsObserver.observe(fileInputs, { childList: true, subtree: true });

                function updateConnections() {
                    if (!mandala) {
                        console.error('Mandala element not found for connections');
                        return;
                    }
                    const mandalaRect = mandala.getBoundingClientRect();
                    const centerX = mandalaRect.left + mandalaRect.width / 2;
                    const centerY = mandalaRect.top + mandalaRect.height / 2;
                    connections.forEach((conn, i) => {
                        const node1 = nodes[i % nodes.length];
                        const node2 = nodes[(i + 1) % nodes.length];
                        if (!node1 || !node2) return;
                        const rect1 = node1.getBoundingClientRect();
                        const rect2 = node2.getBoundingClientRect();
                        const x1 = rect1.left + rect1.width / 2 - mandalaRect.left;
                        const y1 = rect1.top + rect1.height / 2 - mandalaRect.top;
                        const x2 = rect2.left + rect2.width / 2 - mandalaRect.left;
                        const y2 = rect2.top + rect2.height / 2 - mandalaRect.top;
                        const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
                        const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                        conn.style.width = `${length}px`;
                        conn.style.left = `${x1}px`;
                        conn.style.top = `${y1}px`;
                        conn.style.transform = `rotate(${angle}deg)`;
                    });
                }

                window.addEventListener('resize', () => {
                    positionNodes();
                    updateConnections();
                    if (window.p5) loop();
                });
                updateConnections();

                window.showStatus = window.showStatus || function(message, type) {
                    const statusDisplay = document.getElementById('status-display');
                    if (statusDisplay) {
                        statusDisplay.innerHTML = `<div class="status-message ${type}">${message}</div>`;
                        statusDisplay.style.display = 'block';
                        setTimeout(() => statusDisplay.style.display = 'none', 3000);
                    } else {
                        console.log(`Status: ${message} (${type})`);
                    }
                };
            } else {
                console.error('Required elements not found:', { nodes, controlPanel, fileInputs, audioPlayer, closePlayer, waveformContainer, stopAudioBtn, helpPanel });
            }

            // Logo glow and waveform animation tied to audio output
            const audio = document.getElementById('mixed-audio');
            const logo = document.getElementById('logo');
            let audioContext, analyser, source;
            let isAudioAnalysisSetup = false;

            function setupAudioAnalysis() {
                if (!audio || !logo || isAudioAnalysisSetup) return;
                try {
                    isAudioAnalysisSetup = true;
                    console.log('Setting up audio analysis');
                    if (!audioContext) {
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        analyser = audioContext.createAnalyser();
                        analyser.fftSize = 256;
                        source = audioContext.createMediaElementSource(audio);
                        source.connect(analyser);
                        analyser.connect(audioContext.destination);
                    }

                    const bufferLength = analyser.fftSize;
                    const dataArray = new Uint8Array(bufferLength);

                    function updateGlow() {
                        try {
                            analyser.getByteTimeDomainData(dataArray);
                            let sum = 0;
                            for (let i = 0; i < bufferLength; i++) {
                                const sample = (dataArray[i] - 128) / 128;
                                sum += sample * sample;
                            }
                            const rms = Math.sqrt(sum / bufferLength);
                            const glowIntensity = Math.min(rms * 50, 20);
                            logo.style.textShadow = `0 0 ${5 + glowIntensity}px rgba(123, 211, 247, ${0.5 + rms * 0.5})`;
                            if (!audio.paused) requestAnimationFrame(updateGlow);
                        } catch (e) {
                            console.error('Glow update error:', e);
                            window.showStatus('Glow effect update failed.', 'error');
                        }
                    }

                    updateGlow();
                } catch (e) {
                    console.error('Audio analysis setup failed:', e);
                    window.showStatus('Audio glow effect failed. Check console.', 'error');
                    isAudioAnalysisSetup = false;
                }
            }

            // p5.js sketch for scrolling waveform
            let waveformSketch = function(p) {
                let dataArray;
                let bufferLength;

                p.setup = function() {
                    console.log('Waveform sketch setup started');
                    let canvas = p.createCanvas(250, 60);
                    canvas.parent('waveform-container');
                    p.background(0);
                    if (analyser) {
                        bufferLength = analyser.fftSize;
                        dataArray = new Uint8Array(bufferLength);
                    } else {
                        console.error('Analyser not found in waveform setup');
                    }
                    console.log('Waveform sketch setup complete');
                };

                p.draw = function() {
                    if (!audio || audio.paused || !analyser) {
                        p.background(0);
                        return;
                    }
                    console.log('Drawing waveform');
                    p.push();
                    let img = p.get(1, 0, p.width - 1, p.height);
                    p.background(0);
                    p.image(img, 0, 0);
                    analyser.getByteTimeDomainData(dataArray);
                    p.stroke(123, 211, 247);
                    p.strokeWeight(1);
                    p.noFill();
                    let x = p.width - 1;
                    let y = p.map(dataArray[0], 0, 255, p.height, 0);
                    p.line(x, p.height / 2, x, y);
                    p.pop();
                };
            };

            // Add random glowing effect for parameter nodes when audio plays
            let animationFrameId = null;

            function updateNodeGlow() {
                console.log('Updating node glow');
                nodes.forEach(node => {
                    const randomIntensity = Math.random() * 15 + 5;
                    const randomOpacity = Math.random() * 0.5 + 0.3;
                    const randomHue = Math.floor(Math.random() * 360);
                    node.style.boxShadow = `0 0 ${randomIntensity}px rgba(${randomHue}, 80%, 80%, ${randomOpacity})`;
                });
                if (!audio.paused && animationFrameId === null) {
                    animationFrameId = requestAnimationFrame(updateNodeGlow);
                }
            }

            audio.addEventListener('play', () => {
                console.log('Audio play event triggered');
                setupAudioAnalysis();
                if (window.p5 && !window.waveformInstance) {
                    window.waveformInstance = new p5(waveformSketch);
                }
                updateNodeGlow();
            });

            audio.addEventListener('pause', () => {
                console.log('Audio pause event triggered');
                if (window.waveformInstance) {
                    window.waveformInstance.background(0);
                }
                if (animationFrameId !== null) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                nodes.forEach(node => {
                    node.style.boxShadow = '0 0 10px rgba(255, 255, 255, 0.3)';
                });
            });

            audio.addEventListener('ended', () => {
                console.log('Audio ended event triggered');
                // Hide waveform display after one loop
                waveformContainer.style.display = 'none';
                if (window.waveformInstance) {
                    window.waveformInstance.background(0);
                }
                if (animationFrameId !== null) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                nodes.forEach(node => {
                    node.style.boxShadow = '0 0 10px rgba(255, 255, 255, 0.3)';
                });
            });
        } catch (e) {
            console.error('UI initialization failed:', e);
            const statusDisplay = document.getElementById('status-display');
            if (statusDisplay) {
                statusDisplay.innerHTML = '<div class="status-message error">UI failed to load. Check console for details.</div>';
                statusDisplay.style.display = 'block';
            }
        }
    </script>
    <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('SW registered:', reg))
        .catch(err => console.log('SW registration failed:', err));
    });
  }
</script>
</body>
</html>
